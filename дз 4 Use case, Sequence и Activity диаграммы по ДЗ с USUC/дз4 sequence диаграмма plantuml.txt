@startuml

Title Sequence диаграмма по UC

actor Пользователь as п
participant "Веб-сайт" as с
control "Back-end\n системы банка" as б
participant "Яндекс карты" as я

п ++
с ++
п -> с : Доставить банкомат
с -->> п : Открытие страницы с оформлением заказа
п -> с : Выбрать место доставки
с -->> п : Открывает страницу выбора адреса доставки

opt Если ранее указывал адрес
с ->> п : Ранее вы вводили этот адрес: [address]
end

п -> я ++ : Указывает свой адрес на карте

group Шаг проверки адреса
с -> я : Проверка достоверности адреса
я -->> с -- : Ответ
с -> б ++ : Сопоставление с рабочим диапозоном доставки
б -->> с -- : Ответ
с -->> п : Ответ
end

alt Указание адреса в форме
п -> с : 1. Указывает свой адрес
ref over п,с : Отсылаем на "Шаг проверки адреса"
с -->> п : "Данные не достоверны, пожалуйста, заполните адрес еще раз"

loop Если указанный адрес неверный
ref over п,с : Возвращаемся на шаг 1
end

else Если доставка невозможна по выбранному адресу
с -->> п : "По указанному адресу доставка невозможна"

else Если доставка возможна
п -> с : Подтверждение адреса доставки
с -->> п : Открытие страницы с оформлением заказа
п -> с:  Выбрать время доставки из доступного
с -> б ++ : Система определяет доступное время
б -->> с -- : Ответ

alt Нет доступного времени
с -->> п : Сейчас нет доступного времени, попробуйте позже

else Есть доступное время
с -->> п : Доступное время доставки
п -> с : Выбор конкретного времени
с -->> п : Ответ
п -> с : Оформить доставку
с -> б ++ : Информация об адресе и времени доставки
б -->> с : Ответ
б --
с -->> п : Доставка успешно оформлена
end

end

@enduml